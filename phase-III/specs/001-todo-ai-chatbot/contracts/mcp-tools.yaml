# MCP Tools Specification

**Feature**: 001-todo-ai-chatbot
**Protocol**: Model Context Protocol (MCP) v1.0
**Date**: 2026-01-31

## Overview

This document defines the MCP (Model Context Protocol) tools that the OpenAI Agents SDK can invoke to perform task management operations. All tools are stateless and interact directly with the database.

## Tool Registration

All tools are registered with the MCP server using the Official MCP SDK Python package:

```python
from mcp import Tool, ToolContext
from mcp.server import Server

mcp_server = Server("todo-server")

# Tools are registered below using @mcp_server.tool() decorator
```

---

## Tool 1: add_task

### Purpose

Create a new task for a user with a title and optional description.

### Specification

```python
@mcp_server.tool()
async def add_task(
    context: ToolContext,
    user_id: str,
    title: str,
    description: str | None = None
) -> dict
```

### Parameters

| Name | Type | Required | Description |
|------|------|----------|-------------|
| `user_id` | string (UUID) | Yes | The user's unique identifier |
| `title` | string | Yes | The task title (max 500 characters) |
| `description` | string \| null | No | Optional detailed description |

### Return Value

```json
{
  "success": true,
  "task": {
    "id": 42,
    "user_id": "a1b2c3d4-e5f6-7890-abcd-ef1234567890",
    "title": "buy groceries",
    "description": "Get milk, eggs, and bread",
    "completed": false,
    "created_at": "2026-01-31T12:00:00Z",
    "updated_at": "2026-01-31T12:00:00Z"
  },
  "message": "Task 'buy groceries' created successfully"
}
```

### Error Returns

```json
{
  "success": false,
  "error": "validation_error",
  "message": "Title cannot be empty"
}
```

```json
{
  "success": false,
  "error": "database_error",
  "message": "Failed to create task"
}
```

### Validation Rules

- `user_id` must be a valid UUID format
- `title` must be non-empty and <= 500 characters
- `description` must be <= 5000 characters if provided

### Side Effects

- Inserts new row into `tasks` table
- Sets `created_at` and `updated_at` to current timestamp
- Sets `completed` to `false`

### Example Usage

```python
result = await add_task(
    context,
    user_id="a1b2c3d4-e5f6-7890-abcd-ef1234567890",
    title="call dentist",
    description="Schedule appointment for next Tuesday"
)
```

---

## Tool 2: list_tasks

### Purpose

Retrieve tasks for a user, optionally filtered by completion status.

### Specification

```python
@mcp_server.tool()
async def list_tasks(
    context: ToolContext,
    user_id: str,
    status: str = "all"
) -> dict
```

### Parameters

| Name | Type | Required | Description |
|------|------|----------|-------------|
| `user_id` | string (UUID) | Yes | The user's unique identifier |
| `status` | string | No | Filter: "all", "pending", or "completed" (default: "all") |

### Return Value

```json
{
  "success": true,
  "tasks": [
    {
      "id": 42,
      "user_id": "a1b2c3d4-e5f6-7890-abcd-ef1234567890",
      "title": "buy groceries",
      "description": "Get milk, eggs, and bread",
      "completed": false,
      "created_at": "2026-01-31T12:00:00Z",
      "updated_at": "2026-01-31T12:00:00Z"
    },
    {
      "id": 43,
      "user_id": "a1b2c3d4-e5f6-7890-abcd-ef1234567890",
      "title": "call dentist",
      "description": null,
      "completed": true,
      "created_at": "2026-01-30T09:00:00Z",
      "updated_at": "2026-01-30T14:30:00Z"
    }
  ],
  "count": 2
}
```

### Error Returns

```json
{
  "success": false,
  "error": "validation_error",
  "message": "Invalid status filter. Must be 'all', 'pending', or 'completed'"
}
```

### Validation Rules

- `user_id` must be a valid UUID format
- `status` must be one of: "all", "pending", "completed"

### Side Effects

None (read-only operation)

### Example Usage

```python
# List all tasks
result = await list_tasks(context, user_id="...")

# List only pending tasks
result = await list_tasks(context, user_id="...", status="pending")

# List only completed tasks
result = await list_tasks(context, user_id="...", status="completed")
```

---

## Tool 3: complete_task

### Purpose

Mark a task as completed.

### Specification

```python
@mcp_server.tool()
async def complete_task(
    context: ToolContext,
    user_id: str,
    task_id: int
) -> dict
```

### Parameters

| Name | Type | Required | Description |
|------|------|----------|-------------|
| `user_id` | string (UUID) | Yes | The user's unique identifier |
| `task_id` | integer | Yes | The task ID to mark as completed |

### Return Value

```json
{
  "success": true,
  "task": {
    "id": 42,
    "user_id": "a1b2c3d4-e5f6-7890-abcd-ef1234567890",
    "title": "buy groceries",
    "description": "Get milk, eggs, and bread",
    "completed": true,
    "created_at": "2026-01-31T12:00:00Z",
    "updated_at": "2026-01-31T14:30:00Z"
  },
  "message": "Task marked as completed"
}
```

### Error Returns

```json
{
  "success": false,
  "error": "not_found",
  "message": "Task not found or access denied"
}
```

### Validation Rules

- `user_id` must be a valid UUID format
- `task_id` must be a positive integer
- Task must exist and belong to the specified user

### Side Effects

- Updates `completed` to `true` in `tasks` table
- Updates `updated_at` to current timestamp

### Example Usage

```python
result = await complete_task(
    context,
    user_id="a1b2c3d4-e5f6-7890-abcd-ef1234567890",
    task_id=42
)
```

---

## Tool 4: delete_task

### Purpose

Permanently remove a task from the user's task list.

### Specification

```python
@mcp_server.tool()
async def delete_task(
    context: ToolContext,
    user_id: str,
    task_id: int
) -> dict
```

### Parameters

| Name | Type | Required | Description |
|------|------|----------|-------------|
| `user_id` | string (UUID) | Yes | The user's unique identifier |
| `task_id` | integer | Yes | The task ID to delete |

### Return Value

```json
{
  "success": true,
  "deleted_task_id": 42,
  "message": "Task deleted successfully"
}
```

### Error Returns

```json
{
  "success": false,
  "error": "not_found",
  "message": "Task not found or access denied"
}
```

### Validation Rules

- `user_id` must be a valid UUID format
- `task_id` must be a positive integer
- Task must exist and belong to the specified user

### Side Effects

- Permanently deletes row from `tasks` table
- Operation is irreversible

### Example Usage

```python
result = await delete_task(
    context,
    user_id="a1b2c3d4-e5f6-7890-abcd-ef1234567890",
    task_id=42
)
```

---

## Tool 5: update_task

### Purpose

Modify an existing task's title or description.

### Specification

```python
@mcp_server.tool()
async def update_task(
    context: ToolContext,
    user_id: str,
    task_id: int,
    title: str | None = None,
    description: str | None = None
) -> dict
```

### Parameters

| Name | Type | Required | Description |
|------|------|----------|-------------|
| `user_id` | string (UUID) | Yes | The user's unique identifier |
| `task_id` | integer | Yes | The task ID to update |
| `title` | string \| null | No | New title for the task |
| `description` | string \| null | No | New description for the task |

### Return Value

```json
{
  "success": true,
  "task": {
    "id": 42,
    "user_id": "a1b2c3d4-e5f6-7890-abcd-ef1234567890",
    "title": "buy groceries and cook dinner",
    "description": "Get ingredients for pasta",
    "completed": false,
    "created_at": "2026-01-31T12:00:00Z",
    "updated_at": "2026-01-31T15:00:00Z"
  },
  "message": "Task updated successfully"
}
```

### Error Returns

```json
{
  "success": false,
  "error": "validation_error",
  "message": "At least one of 'title' or 'description' must be provided"
}
```

```json
{
  "success": false,
  "error": "not_found",
  "message": "Task not found or access denied"
}
```

### Validation Rules

- `user_id` must be a valid UUID format
- `task_id` must be a positive integer
- At least one of `title` or `description` must be provided
- `title` must be non-empty and <= 500 characters if provided
- `description` must be <= 5000 characters if provided
- Task must exist and belong to the specified user

### Side Effects

- Updates specified fields in `tasks` table
- Updates `updated_at` to current timestamp

### Example Usage

```python
# Update title only
result = await update_task(
    context,
    user_id="a1b2c3d4-e5f6-7890-abcd-ef1234567890",
    task_id=42,
    title="buy groceries and cook dinner"
)

# Update description only
result = await update_task(
    context,
    user_id="a1b2c3d4-e5f6-7890-abcd-ef1234567890",
    task_id=42,
    description="Get ingredients for pasta"
)

# Update both
result = await update_task(
    context,
    user_id="a1b2c3d4-e5f6-7890-abcd-ef1234567890",
    task_id=42,
    title="buy groceries and cook dinner",
    description="Get ingredients for pasta"
)
```

---

## Tool Registration Summary

```python
# Complete MCP server setup
from mcp import Tool, ToolContext
from mcp.server import Server

mcp_server = Server("todo-server")

@mcp_server.tool()
async def add_task(
    context: ToolContext,
    user_id: str,
    title: str,
    description: str | None = None
) -> dict:
    """Create a new task for the user.

    Args:
        user_id: The user's unique identifier
        title: The task title (max 500 characters)
        description: Optional detailed description

    Returns:
        dict with operation status and created task
    """
    # Implementation details in data-model.md
    pass

@mcp_server.tool()
async def list_tasks(
    context: ToolContext,
    user_id: str,
    status: str = "all"
) -> dict:
    """Retrieve tasks for a user with optional status filter.

    Args:
        user_id: The user's unique identifier
        status: Filter by "all", "pending", or "completed" (default: "all")

    Returns:
        dict with list of tasks
    """
    pass

@mcp_server.tool()
async def complete_task(
    context: ToolContext,
    user_id: str,
    task_id: int
) -> dict:
    """Mark a task as completed.

    Args:
        user_id: The user's unique identifier
        task_id: The task ID to mark as completed

    Returns:
        dict with operation status and updated task
    """
    pass

@mcp_server.tool()
async def delete_task(
    context: ToolContext,
    user_id: str,
    task_id: int
) -> dict:
    """Permanently remove a task.

    Args:
        user_id: The user's unique identifier
        task_id: The task ID to delete

    Returns:
        dict with operation status
    """
    pass

@mcp_server.tool()
async def update_task(
    context: ToolContext,
    user_id: str,
    task_id: int,
    title: str | None = None,
    description: str | None = None
) -> dict:
    """Modify an existing task's title or description.

    Args:
        user_id: The user's unique identifier
        task_id: The task ID to update
        title: New title for the task
        description: New description for the task

    Returns:
        dict with operation status and updated task
    """
    pass
```

---

## Tool Metadata

All tools include the following metadata for AI agent understanding:

### Tool Descriptions

- `add_task`: "Create a new todo task with a title and optional description"
- `list_tasks`: "Retrieve all tasks or filter by completion status (pending/completed)"
- `complete_task`: "Mark a specific task as completed/done"
- `delete_task`: "Permanently remove a task from the task list"
- `update_task`: "Modify the title or description of an existing task"

### Parameter Descriptions

Each parameter includes a clear description to help the AI agent understand:
- What the parameter represents
- Valid values or formats
- Whether it's required or optional
- Constraints (length, type, etc.)

### Error Handling

All tools follow consistent error handling:
1. Validate input parameters
2. Check data isolation (user_id matches task owner)
3. Perform database operation
4. Return structured response with `success` boolean
5. Include error details if operation fails

---

## Integration with OpenAI Agents SDK

### Tool Adapter

```python
from mcp.adapters.openai import OpenAIAdapter

# Convert MCP tools to OpenAI function format
adapter = OpenAIAdapter(mcp_server)
openai_tools = adapter.get_tools()

# Register with agent
agent = Agent(
    name="todo_assistant",
    instructions="You help users manage their todo tasks...",
    tools=openai_tools
)
```

### Tool Call Flow

```
User Message
    ↓
OpenAI Agents SDK (interprets intent)
    ↓
Selects appropriate MCP tool(s)
    ↓
Executes tool with parameters
    ↓
MCP tool performs database operation
    ↓
Returns structured result
    ↓
Agent formulates natural language response
    ↓
Returns response to user
```

---

**MCP Tools Specification Version**: 1.0.0 | **Last Updated**: 2026-01-31
