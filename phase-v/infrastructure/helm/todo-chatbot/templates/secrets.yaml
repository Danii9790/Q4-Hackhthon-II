---
# Secrets for the Todo Chatbot application
# IMPORTANT: In production, use external secret management (e.g., sealed-secrets, vault, External Secrets Operator)
# DO NOT commit actual secrets to version control

{{- if .Values.backend.enabled }}
# Backend secrets
apiVersion: v1
kind: Secret
metadata:
  name: {{ include "todo-chatbot.fullname" . }}-backend-secrets
  namespace: {{ .Values.global.namespace }}
  labels:
    {{- include "todo-chatbot.backend.labels" . | nindent 4 }}
type: Opaque
stringData:
  # Database credentials (or DATABASE_URL for external databases)
  {{- if .Values.backend.database.external }}
  database-url: "{{ .Values.backend.database.url | default \"postgresql://user:password@host:port/database\" }}"
  {{- else }}
  database-user: "{{ .Values.backend.database.user | default \"todo_user\" }}"
  database-password: "{{ .Values.backend.database.password | default \"change-me-in-production\" }}"
  {{- end }}

  # JWT secret (generate with: openssl rand -hex 32)
  jwt-secret: "{{ .Values.backend.jwtSecret | default \"change-me-in-production-use-openssl-rand-hex-32\" }}"

  # OpenAI API Key (if needed)
  openai-api-key: "{{ .Values.backend.openaiApiKey | default \"\" }}"

  # Any other backend secrets
  {{- range $key, $value := .Values.backend.secrets }}
  {{ $key }}: "{{ $value }}"
  {{- end }}
{{- end }}

---
{{- if and .Values.backend.enabled .Values.backend.kafka.external }}
# Kafka secrets (for external Kafka)
apiVersion: v1
kind: Secret
metadata:
  name: {{ include "todo-chatbot.fullname" . }}-kafka-secrets
  namespace: {{ .Values.global.namespace }}
  labels:
    {{- include "todo-chatbot.backend.labels" . | nindent 4 }}
type: Opaque
stringData:
  # Kafka bootstrap servers (external)
  bootstrap-servers: "{{ .Values.backend.kafka.bootstrapServersExternal | default \"your-cluster.redpanda.cloud:9092\" }}"

  # SASL authentication (if enabled)
  username: "{{ .Values.backend.kafka.saslUsername | default \"\" }}"
  password: "{{ .Values.backend.kafka.saslPassword | default \"\" }}"

  # API Key (for Redpanda Cloud)
  api-key: "{{ .Values.backend.kafka.apiKey | default \"\" }}"
{{- end }}

---
{{- if .Values.postgresql.enabled }}
# PostgreSQL secrets (for internal PostgreSQL)
apiVersion: v1
kind: Secret
metadata:
  name: {{ include "todo-chatbot.fullname" . }}-postgresql-secrets
  namespace: {{ .Values.global.namespace }}
  labels:
    app.kubernetes.io/component: database
type: Opaque
stringData:
  postgres-password: "{{ .Values.postgresql.auth.password | default \"change-me-in-production\" }}"
  postgres-user: "{{ .Values.postgresql.auth.username | default \"todo_user\" }}"
{{- end }}
