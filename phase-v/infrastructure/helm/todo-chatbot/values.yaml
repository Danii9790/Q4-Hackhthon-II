---
# Default values for todo-chatbot
# This is a YAML-formatted file.
# Declare variables to be passed into your templates.

# Global configuration
global:
  environment: "production"
  namespace: "todo-app"
  imagePullPolicy: IfNotPresent
  # Registry for pulling images
  imageRegistry: "docker.io"
  # Storage class for persistent volumes
  storageClass: "standard"

# Backend configuration
backend:
  enabled: true
  replicaCount: 2

  image:
    repository: todo-backend
    tag: "1.0.0"
    pullPolicy: IfNotPresent

  # Service configuration
  service:
    type: ClusterIP
    port: 8000

  # Ingress configuration
  ingress:
    enabled: false
    className: "nginx"
    annotations: {}
    hosts:
      - host: api.todo.example.com
        paths:
          - path: /
            pathType: Prefix
    tls: []

  # Resource limits and requests
  resources:
    requests:
      cpu: 100m
      memory: 128Mi
    limits:
      cpu: 500m
      memory: 512Mi

  # Horizontal Pod Autoscaler
  autoscaling:
    enabled: true
    minReplicas: 2
    maxReplicas: 10
    targetCPUUtilizationPercentage: 70
    targetMemoryUtilizationPercentage: 80

  # Dapr sidecar configuration
  dapr:
    enabled: true
    appId: "todo-backend"
    appPort: 8000
    logLevel: "info"

  # Environment variables
  env:
    LOG_LEVEL: "INFO"
    ENVIRONMENT: "production"

  # Database configuration
  database:
    # Use external database (e.g., Neon)
    external: true
    url: ""  # Set via Secret
    host: ""  # Set via Secret or ConfigMap
    port: 5432
    name: "todo_db"
    user: ""  # Set via Secret
    password: ""  # Set via Secret

  # Kafka configuration
  kafka:
    bootstrapServers: "kafka-service.todo-app.svc.cluster.local:9092"
    # For external Kafka (e.g., Redpanda Cloud)
    external: false
    bootstrapServersExternal: ""
    saslEnabled: false
    saslMechanism: "PLAIN"
    saslUsername: ""
    saslPassword: ""

  # Health check probes
  livenessProbe:
    httpGet:
      path: /health
      port: 8000
    initialDelaySeconds: 30
    periodSeconds: 10
    timeoutSeconds: 5
    failureThreshold: 3

  readinessProbe:
    httpGet:
      path: /health
      port: 8000
    initialDelaySeconds: 10
    periodSeconds: 5
    timeoutSeconds: 3
    failureThreshold: 3

  # Pod monitoring
  podMonitor:
    enabled: true
    interval: 30s
    scrapeTimeout: 10s

# Frontend configuration
frontend:
  enabled: true
  replicaCount: 2

  image:
    repository: todo-frontend
    tag: "1.0.0"
    pullPolicy: IfNotPresent

  # Service configuration
  service:
    type: ClusterIP
    port: 3000

  # Ingress configuration
  ingress:
    enabled: true
    className: "nginx"
    annotations:
      nginx.ingress.kubernetes.io/rewrite-target: /
      nginx.ingress.kubernetes.io/ssl-redirect: "true"
      nginx.ingress.kubernetes.io/force-ssl-redirect: "true"
      nginx.ingress.kubernetes.io/security-headers: "true"
    hosts:
      - host: todo.example.com
        paths:
          - path: /
            pathType: Prefix
    tls:
      - secretName: frontend-tls-secret
        hosts:
          - todo.example.com

  # Resource limits and requests
  resources:
    requests:
      cpu: 50m
      memory: 64Mi
    limits:
      cpu: 200m
      memory: 256Mi

  # Horizontal Pod Autoscaler
  autoscaling:
    enabled: true
    minReplicas: 2
    maxReplicas: 10
    targetCPUUtilizationPercentage: 70
    targetMemoryUtilizationPercentage: 80

  # Environment variables
  env:
    NEXT_PUBLIC_APP_NAME: "Todo Chatbot"
    NEXT_PUBLIC_ENVIRONMENT: "production"
    NEXT_PUBLIC_API_URL: "https://api.todo.example.com"
    NEXT_PUBLIC_WS_URL: "wss://api.todo.example.com"

  # Health check probes
  livenessProbe:
    httpGet:
      path: /
      port: 3000
    initialDelaySeconds: 30
    periodSeconds: 10
    timeoutSeconds: 5
    failureThreshold: 3

  readinessProbe:
    httpGet:
      path: /
      port: 3000
    initialDelaySeconds: 10
    periodSeconds: 5
    timeoutSeconds: 3
    failureThreshold: 3

# Kafka (Redpanda) configuration
kafka:
  enabled: true
  # Use external Kafka (e.g., Redpanda Cloud)
  external: false
  name: "redpanda"
  replicaCount: 1
  # For external Kafka
  bootstrapServers: ""
  saslEnabled: false
  saslMechanism: "PLAIN"
  saslUsername: ""
  saslPassword: ""

  resources:
    requests:
      cpu: 100m
      memory: 256Mi
    limits:
      cpu: 500m
      memory: 512Mi

  persistence:
    enabled: true
    storageClass: "standard"
    size: 1Gi

  # Topics to create
  topics:
    - name: task-events
      partitions: 3
      replicationFactor: 1
      config:
        retention.ms: "604800000"  # 7 days
        cleanup.policy: "delete"
    - name: task-updates
      partitions: 3
      replicationFactor: 1
      config:
        retention.ms: "86400000"  # 1 day
        cleanup.policy: "delete"
    - name: reminders
      partitions: 3
      replicationFactor: 1
      config:
        retention.ms: "86400000"  # 1 day
        cleanup.policy: "delete"

# PostgreSQL configuration (if not using external database)
postgresql:
  enabled: false  # Use external Neon database in production
  replicaCount: 1
  image:
    repository: postgres
    tag: "15"
  auth:
    database: "todo_db"
    username: "todo_user"
    password: ""  # Set via Secret
  persistence:
    enabled: true
    storageClass: "standard"
    size: 1Gi
  resources:
    requests:
      cpu: 50m
      memory: 64Mi
    limits:
      cpu: 200m
      memory: 256Mi

# Dapr configuration
dapr:
  enabled: true
  # Dapr sidecar configuration is applied per deployment

# Monitoring configuration
monitoring:
  enabled: false  # Set to true to enable Prometheus monitoring
  namespace: "monitoring"

# Service Account configuration
serviceAccount:
  create: true
  annotations: {}
  name: ""

# Pod Security Context
podSecurityContext:
  runAsNonRoot: true
  runAsUser: 1000
  fsGroup: 1000

# Container Security Context
securityContext:
  allowPrivilegeEscalation: false
  capabilities:
    drop:
      - ALL
  readOnlyRootFilesystem: false

# Node selector
nodeSelector: {}

# Tolerations
tolerations: []

# Affinity rules
affinity: {}
